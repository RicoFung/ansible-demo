---
# get start build time
- name: ====== 5 ======== get start build time
  shell: date +%Y%m%d_%H%M%S
  register: build_time

# 删除本地仓库旧版本包
- name: ====== 6 ======== remove old package in local repository
  shell: source /etc/profile && source ~/.bash_profile  && rm -rf {{GV_REMOVE_OLD_PACKAGE}}

# 编译代码 - 如果代码有更新的话  && source ~/bash_profile
- name: ====== 7 ======== build project
  shell: source /etc/profile && source ~/.bash_profile  && mvn clean deploy -P{{EV_PROFILE}} --settings {{EV_IPOS_ANSIBLE}}/ansible_scripts/{{EV_ANSIBLE_ENV}}/settings_ipos.xml -Dmaven.test.skip=true
  args:
    chdir: "{{GV_POM_DIR}}"
  #when: pull_result.before != pull_result.after
  
# 检查包是否存在
- name: ====== 7_1 ======== check this package file exists
  stat:
    path: "{{GV_TARGET_WAR_PATH}}"
  register: check_this_package_file
  
- name: ====== 7_2 ========= set facts
  set_fact: check_this_package_file="{{check_this_package_file}}" 