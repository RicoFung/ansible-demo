---
# 检查上次的包是否存在
- name: ====== 0 ======== check last package file exists
  stat:
    path: "{{GV_TARGET_WAR_PATH}}"
  register: check_last_package_file
  
- name: ====== 0_1 ========= set facts
  set_fact: check_last_package_file={{check_last_package_file}}

# 创建备份目录
- name: ====== 1 ======== create backup dir
  file:
    path: "{{GV_BACKUP_DIR}}"
    state: directory
    
# 备份
- name: ====== 2 ======== backup
  copy:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    remote_src: no
  with_items:
  - { src: "{{GV_TARGET_WAR_PATH}}", dest: "{{GV_BACKUP_DIR}}/{{GV_WAR_FILE}}" }
  when: check_last_package_file.stat.exists